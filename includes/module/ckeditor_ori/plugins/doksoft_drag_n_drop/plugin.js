CKEDITOR.plugins.add("doksoft_drag_n_drop",{lang:["en"],init:function(a){if(!CKEDITOR.config.doksoft_drag_n_drop_preview_treshold){CKEDITOR.config.doksoft_drag_n_drop_preview_treshold=800;}if(!CKEDITOR.config.doksoft_drag_n_drop_embed_treshold){CKEDITOR.config.doksoft_drag_n_drop_embed_treshold=48;}if(!CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority=true;}if(typeof a.lang.doksoft_drag_n_drop.doksoft_drag_n_drop!="undefined"){a.lang.doksoft_drag_n_drop=a.lang.doksoft_drag_n_drop.doksoft_drag_n_drop;}var c=document;var b=c.createElement("link");b.href=CKEDITOR.plugins.getPath("doksoft_drag_n_drop")+"style.css";b.type="text/css";b.rel="stylesheet";c.head.appendChild(b);a.on("contentDom",function(){var g=false;var h=function(n){var r=a.document.getBody().getParent();var m=r.$.getBoundingClientRect();var q=m.left;var p=m.top;var l=q+r.$.clientWidth;var k=p+r.$.clientHeight;var o=n.data.$;if(o.clientX<=q||o.clientY<=p||o.clientX>=l||o.clientY>=k){return false;}else{return true;}};var j=function(l,q,m,p,k,r){if(Object.prototype.toString.call(l)==="[object Array]"){for(var s=0;s<l.length;s++){if(typeof(window[l[s]+"_upload_dropped_files"])==="function"){var o=window[l[s]+"_upload_dropped_files"];o(q,m,k,r);return;}}}else{if(typeof(window[l+"_upload_dropped_files"])==="function"){var o=window[l+"_upload_dropped_files"];o(q,m,k,r);return;}}alert(p);};var i=function(m,p,o){var k=window.URL||window.webkitURL;if(m[o].isImage){var l=new Image();l.onload=function(){m[o].width=l.width;m[o].height=l.height;o++;if(o==m.length){p(m);}else{i(m,p,o);}};l.src=k.createObjectURL(m[o]);}};var e=function(l,p){var k=l.length;for(var o=0;o<l.length;o++){var m=l[o].type.indexOf("image/")==0;l[o].isImage=m;if(!m){k--;}}if(k==0){p(l);}else{i(l,p,0);}};var d=function(m){var o=true;for(var p=0;p<m.length&&o;p++){if(!m[p].isImage){o=false;}}if(!o){if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_instant_file","doksoft_file"];}else{return["doksoft_file","doksoft_instant_file"];}}else{var k=true;var l=false;for(var p=0;p<m.length&&k;p++){if(m[p].width<CKEDITOR.config.doksoft_drag_n_drop_preview_treshold||m[p].height<CKEDITOR.config.doksoft_drag_n_drop_preview_treshold){k=false;}}if(!k){l=true;for(var p=0;p<m.length&&l;p++){if(m[p].width>CKEDITOR.config.doksoft_drag_n_drop_embed_treshold||m[p].height>CKEDITOR.config.doksoft_drag_n_drop_embed_treshold){allImagesAreVery=false;}}}if(k){if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_instant_preview","doksoft_preview","doksoft_instant_image","doksoft_image","doksoft_instant_file","doksoft_file","doksoft_embed"];}else{return["doksoft_preview","doksoft_instant_preview","doksoft_image","doksoft_instant_image","doksoft_file","doksoft_instant_file","doksoft_embed"];}}else{if(l){if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_embed","doksoft_instant_image","doksoft_image","doksoft_instant_preview","doksoft_preview","doksoft_instant_file","doksoft_file"];}else{return["doksoft_embed","doksoft_image","doksoft_instant_image","doksoft_preview","doksoft_instant_preview","doksoft_file","doksoft_instant_file"];}}else{if(CKEDITOR.config.doksoft_drag_n_drop_instant_upload_is_priority){return["doksoft_instant_image","doksoft_image","doksoft_instant_preview","doksoft_preview","doksoft_instant_file","doksoft_file","doksoft_embed"];}else{return["doksoft_image","doksoft_instant_image","doksoft_preview","doksoft_instant_preview","doksoft_file","doksoft_instant_file","doksoft_embed"];}}}}};var f=function(n,l,m){var k=l.document.$.caretRangeFromPoint(m.clientX,m.clientY);var o=m.target;e(n,function(){var p;if(window["doksoft_drag_n_drop_get_handlers_list"]&&typeof(window["doksoft_drag_n_drop_get_handlers_list"])=="function"){p=window["doksoft_drag_n_drop_get_handlers_list"](n);}else{p=d(n);}j(p,n,l,l.lang.doksoft_drag_n_drop.no_handler,k,o);});};a.document.on("dragenter",function(k){if(a.elementMode==3){}else{if(h(k)){document.getElementById(a.id+"_contents").classList.add("doksoft-drag-n-drop-hover");g=true;}}});a.document.on("dragleave",function(k){if(a.elementMode==3){}else{if(!h(k)){document.getElementById(a.id+"_contents").classList.remove("doksoft-drag-n-drop-hover");g=false;}}});a.document.on("dragover",function(k){if(a.elementMode==3){}else{if(!h(k)){k.data.preventDefault();}}});a.document.on("drop",function(l){g=false;var k=l.data.$.dataTransfer.files;if(a.elementMode==3){}else{if(h(l)){l.data.preventDefault();document.getElementById(a.id+"_contents").classList.remove("doksoft-drag-n-drop-hover");f(k,a,l.data.$);}}});});}});